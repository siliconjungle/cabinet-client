!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.index=e():t.index=e()}(this,(function(){return(()=>{var t={553:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,i=Object.create(o.prototype),s=new j(r||[]);return i._invoke=function(t,e,n){var r=l;return function(o,i){if(r===p)throw new Error("Generator is already running");if(r===y){if("throw"===o)throw i;return N()}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=_(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=f(t,e,n);if("normal"===u.type){if(r=n.done?y:h,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=y,n.method="throw",n.arg=u.arg)}}}(t,n,s),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l="suspendedStart",h="suspendedYield",p="executing",y="completed",v={};function d(){}function g(){}function m(){}var b={};u(b,i,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(C([])));S&&S!==n&&r.call(S,i)&&(b=S);var L=m.prototype=d.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(o,i,s,a){var u=f(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}}function _(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=f(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function C(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:N}}function N(){return{value:e,done:!0}}return g.prototype=m,u(L,"constructor",m),u(m,"constructor",g),g.displayName=u(m,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,a,"GeneratorFunction")),t.prototype=Object.create(L),t},t.awrap=function(t){return{__await:t}},x(O.prototype),u(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var s=new O(c(e,n,r,o),i);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},x(L),u(L,a,"Generator"),u(L,i,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=C,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var u=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:C(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},757:(t,e,n)=>{t.exports=n(553)},187:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}t.exports=i,t.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}v(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&v(t,"error",e,{once:!0})}(t,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function c(t,e,n,r){var o,i,s,c;if(a(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),s=i[e]),void 0===s)s=i[e]=n,++t._eventsCount;else if("function"==typeof s?s=i[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=u(t))>0&&s.length>o&&!s.warned){s.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=t,f.type=e,f.count=s.length,c=f,console&&console.warn&&console.warn(c)}return t}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=f.bind(r);return o.listener=n,r.wrapFn=o,o}function h(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):y(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function v(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)r(u,this,e);else{var c=u.length,f=y(u,c);for(n=0;n<c;++n)r(f[n],this,e)}return!0},i.prototype.addListener=function(t,e){return c(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return c(this,t,e,!0)},i.prototype.once=function(t,e){return a(e),this.on(t,l(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,l(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,o,i,s;if(a(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return h(this,t,!0)},i.prototype.rawListeners=function(t){return h(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{CabinetClient:()=>A,CabinetProvider:()=>J,space:()=>C,useShelf:()=>F});var t=n(187),e=new(n.n(t)());e.setMaxListeners(0);var o={};const i="object",s="array",a={object:0,array:1,string:2,number:3,boolean:4,null:5,other:6},u=t=>a[c(t)],c=t=>null===t?"null":Array.isArray(t)?s:Object.keys(a).includes(typeof t)?typeof t:"other",f=(t,e)=>{if(0===e.length)return Array.isArray(t)?t[1]:t;let n=t;return e.forEach((t=>{n=Array.isArray(n)?n[0][t]:n[t]})),Array.isArray(n)?n[1]:n||0},l=(t,e)=>t===i?[{},e]:t===s?[[],e]:e,h=(t,e,n)=>({key:t,type:"set",value:e,version:n}),p=(t=null)=>{const e={value:null,versions:0,history:[]};if(t){const n=g(e.value,t,0);return v(e,n)}return e},y=(t,e)=>{const n=(r=t,JSON.parse(JSON.stringify(r)));var r;return"set"===e.type?((t,e)=>{const n=((t,e)=>{if(0===e.length)return t;if(null===t)return;let n=t;for(let t=0;t<e.length-1;t++)if(n=n[e[t]],null==n)return;return n=n[e[e.length-1]],n})(t.value,e.key);if(void 0===n)return!0;const r=f(t.versions,e.key);return r<e.version||r===e.version&&1===((t,e)=>{const n=u(t),r=u(e);if(n<r)return 1;if(n>r)return-1;if(n===a.object)return 0;if(n===a.array||n===a.other){const n=JSON.stringify(t),r=JSON.stringify(e);return n===r?0:n<r?1:-1}return t===e?0:t<e?1:-1})(n,e.value)})(n,e)&&(((t,e)=>{const n=t.history.findIndex((t=>JSON.stringify(t.key)===JSON.stringify(e.key)));-1===n?t.history.push(e):t.history[n]=e})(n,e),((t,e)=>{t.versions=((t,e,n,r)=>{if(0===e.length)return l(r,n);let o=t;for(let t=0;t<e.length-1;t++)o=Array.isArray(o)?o[0][e[t]]:o[e[t]];return Array.isArray(o)?o[0][e[e.length-1]]=l(r,n):o[e[e.length-1]]=l(r,n),t})(t.versions,e.key,e.version,c(e.value)),t.value=((t,e,n)=>{if(0===e.length)return n;let r=t;for(let t=0;t<e.length-1;t++)r=r[e[t]];return r[e[e.length-1]]=n,t})(t.value,e.key,e.value)})(n,e)):"insert"===e.type||e.type,n},v=(t,e)=>{let n=t;return e.forEach((t=>{n=y(n,t)})),n},d=(t,e=1,n=[],r=[])=>{const o=c(t);return o===i?(r.push(h(n,{},e)),[...new Set([...Object.keys(t)])].forEach((o=>{d(t[o]??null,e,[...n,o],r)}))):o===s?(r.push(h(n,[],e)),t.forEach(((o,i)=>{d(t[i]??null,e,[...n,i],r)}))):r.push(h(n,t,e)),r},g=(t,e,n,r=[],o=[])=>{if(JSON.stringify(t)===JSON.stringify(e))return o;if(void 0===t)return o.push(...d(e,1,r)),o;const a=c(t),u=c(e);if(null===t)return o.push(...d(e,f(n,r)+1,r)),o;if(a===i&&u===i)return[...new Set([...Object.keys(t),...Object.keys(e)])].forEach((i=>{g(t[i]??null,e[i]??null,n,[...r,i],o)})),o;if(a===s&&u===s){const i=Math.max(t.length,e.length);for(let s=0;s<i;s++)g(t[s]??null,e[s]??null,n,[...r,s],o);return o}return o.push(h(r,e,f(n,r)+1)),o};function m(e,n){this.emitter=new t,this.emitter.setMaxListeners(0),this.repository=e,this.name=n,this.store={}}m.prototype.getSubscribedKeys=function(){return Object.keys(this.store)},m.prototype.getKeys=async function(){return await this.repository.getKeys(this.name)},m.prototype.removeShelf=function(t){delete this.store[t]},m.prototype.deleteShelf=async function(t){delete this.store[t],await this.repository.removeShelf(this.name,t)},m.prototype.getState=async function(t){return this.store[t]?.value||await this.repository.getShelfByKey(this.name,t).value||p().value},m.prototype.getShelf=async function(t){return this.store[t]||await this.repository.getShelfByKey(this.name,t)||p()},m.prototype.setState=async function(t,e){let n=await this.getShelf(t);if(n){const r=g(n.value,e,n.versions),o=v(n,r);return this.setShelf(t,o,r),r}return n=p(e),this.setShelf(t,n,n.history),n.history},m.prototype.setShelf=function(t,e,n){this.store[t]=e,this.repository.setShelfByKey(this.name,t,e),this.emitter.emit(t,this.name,t,e,n)},m.prototype.applyOp=async function(t,e){let n=await this.getShelf(t);this.setShelf(t,y(n||p(),e),[e])},m.prototype.applyOps=async function(t,e){const n=await this.getShelf(t);this.setShelf(t,v(n||p(),e),e)},m.prototype.initShelf=async function(t){const e=await this.repository.getShelfByKey(this.name,t);e&&this.setShelf(t,e,e.history)},m.prototype.addSubscription=function(t,e){this.store[t]||this.initShelf(t),this.emitter.addListener(t,e)},m.prototype.removeSubscription=function(t,e){this.emitter.removeListener(t,e),0===this.emitter.listenerCount(t)&&this.removeShelf(t)},m.prototype.getSubscriptionCount=function(t){this.emitter.listenerCount(t)};const b=m;function w(t){this.repository=t,this.cabinets={}}w.prototype.getCabinet=function(t){return void 0===this.cabinets[t]&&(this.cabinets[t]=new b(this.repository,t)),this.cabinets[t]};const S=w;function L(t,e,n,r,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function x(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function s(t){L(i,r,o,s,a,"next",t)}function a(t){L(i,r,o,s,a,"throw",t)}s(void 0)}))}}var O=n(757),_=n.n(O),E=function(){var t=x(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",[]);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=x(_().mark((function t(e,n){var r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!=typeof window){t.next=2;break}return t.abrupt("return",null);case 2:return r=window.localStorage.getItem("".concat(e).concat(n)),t.abrupt("return",r&&JSON.parse(r)||null);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),j=function(){var t=x(_().mark((function t(e,n,r){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!=typeof window){t.next=2;break}return t.abrupt("return",null);case 2:localStorage.setItem("".concat(e).concat(n),JSON.stringify(r));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}();const C=new S({getKeys:E,getShelfByKey:k,setShelfByKey:j});var N="undefined"!=typeof window;const A=function(t){var n=this;this.messages=[],this.connection=null,this.accessToken=t.accessToken,this.onmessage=function(t){var n=JSON.parse(t.data),r=n.type,i=n.data;if("get"===r){var s=i.cabinet,a=i.key,u=i.patches;!function(t,n,r){o[t]=o[t]||{},o[t][n]=r,e.emit("".concat(t).concat(n),r)}(s,a,i.users),C.getCabinet(s).applyOps(a,u)}},this.onopen=function(t){n.messages.forEach((function(t){n.sendMessage(t)}))},this.onclose=function(t){Object.keys(o).forEach((function(t){Object.keys(o[t]).forEach((function(n){e.emit("".concat(t).concat(n),[])}))})),o={},n.createConnection()},this.createConnection=function(){n.connection=new WebSocket(t.uri),n.connection.onmessage=n.onmessage,n.connection.onopen=n.onopen,n.connection.onclose=n.onclose},N&&this.createConnection(),this.sendMessage=function(t){var e;if((null===(e=n.connection)||void 0===e?void 0:e.readyState)===WebSocket.OPEN)n.connection.send(JSON.stringify(t));else{if("set"===t.type){var r=n.messages.find((function(e){return t.data.cabinet===e.data.cabinet&&t.data.key===e.data.key}));if(r)return void r.data.patches.push(t.data.patches)}n.messages.push(t)}},this.subscribe=function(t,e,r){n.sendMessage({type:"subscribe",accessToken:n.accessToken,data:{cabinet:t,key:e,patches:r}})},this.unsubscribe=function(t,e){n.sendMessage({type:"unsubscribe",accessToken:n.accessToken,data:{cabinet:t,key:e}})},this.uri=t.uri},T=require("react");var P=n.n(T);const M=(0,T.createContext)({client:null,addSubscription:null,removeSubscription:null}),J=function(t){var e=t.client,n=t.children,r=(0,T.useCallback)((function(t,n,r){var o=C.getCabinet(t);o.getShelf(n).then((function(i){e.subscribe(t,n,i.history),o.addSubscription(n,r)}))}),[e]),o=(0,T.useCallback)((function(t,n,r){C.getCabinet(t).removeSubscription(n,r),null==e||e.unsubscribe(t,n)}),[e]),i={client:e,addSubscription:r,removeSubscription:o};return P().createElement(M.Provider,{value:i},n)};function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const F=function(t,e){var n,r,o=(n=(0,T.useState)(null),r=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],s=o[1],a=(0,T.useContext)(M),u=a.client,c=a.addSubscription,f=a.removeSubscription,l=(0,T.useCallback)((function(t,e,n){JSON.stringify(n.value)!==JSON.stringify(i)&&s(n.value)}),[t,e]),h=(0,T.useCallback)((function(n){C.getCabinet(t).setState(e,n).then((function(n){u.sendMessage({accessToken:u.accessToken,type:"set",data:{cabinet:t,key:e,patches:n}})}))}),[t,e,u]);return(0,T.useEffect)((function(){return c(t,e,l),function(){f(t,e,l)}}),[t,e,l]),[i,h]}})(),r})()}));